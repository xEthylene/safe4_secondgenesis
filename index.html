<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAFE4: Second Genesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 1. Add Babel Standalone for in-browser JSX/TS transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.1.1/",
    "react": "https://aistudiocdn.com/react@^19.1.1",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.15.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "@heroicons/react/": "https://aistudiocdn.com/@heroicons/react@^2.2.0/",
    "https://esm.sh/immer": "https://aistudiocdn.com/immer@^10.1.1",
    "immer": "https://aistudiocdn.com/immer@^10.1.1"
  }
}
</script>
<style>
  :root {
    --color-bg: #111827; /* gray-900 */
    --color-text: #f3f4f6; /* gray-100 */
    --color-primary: #3b82f6; /* blue-500 */
    --color-primary-dark: #1e40af; /* blue-800 */
    --color-primary-light: #60a5fa; /* blue-400 */
    --color-secondary: #ef4444; /* red-500 */
    --color-secondary-dark: #b91c1c; /* red-700 */
  }
  body {
    background-color: var(--color-bg);
    color: var(--color-text);
  }
  .app-container {
    box-shadow: 0 0 25px 5px rgba(59, 130, 246, 0.15);
    border-color: rgba(59, 130, 246, 0.2);
  }
  .text-primary { color: var(--color-primary-light); }
  .bg-primary { background-color: var(--color-primary); }
  .hover\:bg-primary-light:hover { background-color: var(--color-primary-light); }
  .border-primary { border-color: var(--color-primary); }
  .bg-secondary { background-color: var(--color-secondary); }
  .hover\:bg-secondary-dark:hover { background-color: var(--color-secondary-dark); }
  .border-secondary { border-color: var(--color-secondary); }
  
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .animate-fadeIn { animation: fadeIn 0.3s ease-in-out forwards; }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
  .animate-fadeOut { animation: fadeOut 0.3s ease-in-out forwards; }
  
  .drawer-backdrop { animation: fadeIn 0.3s ease-in-out; }
  @keyframes dissolve { 0% { opacity: 1; filter: blur(0); } 100% { opacity: 0; filter: blur(10px); transform: scale(0.9); } }
  .animate-dissolve { animation: dissolve 0.7s forwards; }
  @keyframes float-up {
    0% { transform: translateY(0) scale(0.8); opacity: 1; }
    30% { transform: translateY(-20px) scale(1.1); opacity: 1; }
    100% { transform: translateY(-50px) scale(0.9); opacity: 0; }
  }
  .animate-float-up { animation: float-up 1.2s forwards ease-out; }
  @keyframes enemy-card-reveal {
    0% { opacity: 0; transform: scale(0.5) translateY(50px); }
    100% { opacity: 1; transform: scale(0.8) translateY(-20px); }
  }
  .animate-enemy-card-reveal { animation: enemy-card-reveal 0.5s forwards ease-in-out; }
  @keyframes enemy-play-card {
    0% { transform: scale(0.9) translateY(-20px) rotate(-3deg); opacity: 1; }
    50% { transform: scale(1.15) translateY(-90px) rotate(0deg); opacity: 1; }
    100% { transform: scale(0.6) translateY(0px) rotate(3deg); opacity: 0; }
  }
  .animate-enemy-play-card {
    animation: enemy-play-card 1.2s ease-in-out forwards;
  }
  
  @keyframes player-play-card {
    0% { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
    50% { transform: translateY(-250px) scale(1.1) rotate(-2deg); opacity: 1; }
    100% { transform: translateY(-200px) scale(0.5) rotate(5deg); opacity: 0; }
  }
  .animate-player-play-card {
    animation: player-play-card 1s ease-in-out forwards;
  }

  /* Card Reveal Animation */
  .card-reveal-container {
    perspective: 1000px;
  }
  .card-flipper {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s;
    transform-style: preserve-3d;
  }
  .card-flipper.is-flipped {
    transform: rotateY(180deg);
  }
  .card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden; /* Safari */
    backface-visibility: hidden;
    border-radius: 0.5rem; /* 8px */
  }
  .card-back {
    transform: rotateY(180deg);
  }
  @keyframes enemy-attack {
    50% { transform: translateY(-15px) scale(1.05); }
  }
  .animate-enemy-attack {
    animation: enemy-attack 0.6s ease-in-out;
  }
  
  /* Combat VFX */
  @keyframes hit-flash-red { 0%, 100% { filter: brightness(1) drop-shadow(0 0 0 transparent); } 50% { filter: brightness(2.5) drop-shadow(0 0 15px red); } }
  .animate-hit_hp { animation: hit-flash-red 0.3s ease-out; }

  @keyframes shield-impact { 0%, 100% { box-shadow: 0 0 0 0 transparent; } 50% { box-shadow: 0 0 25px 12px rgba(59, 130, 246, 0.7); } }
  .animate-hit_block { animation: shield-impact 0.4s ease-out; }
  
  @keyframes burn-pulse { 0%, 100% { filter: drop-shadow(0 0 0 transparent); transform: scale(1); } 50% { filter: brightness(1.5) drop-shadow(0 0 15px orange); transform: scale(1.2); } }
  .animate-burn { animation: burn-pulse 0.5s ease-in-out; }
  
  @keyframes bleed-pulse { 0%, 100% { filter: drop-shadow(0 0 0 transparent); transform: scale(1); } 50% { filter: brightness(1.5) drop-shadow(0 0 15px darkred); transform: scale(1.2); } }
  .animate-bleed { animation: bleed-pulse 0.5s ease-in-out; }

  @keyframes screen-shake {
    0% { transform: translate(0, 0) rotate(0deg); }
    10% { transform: translate(-2px, -3px) rotate(-1deg); }
    20% { transform: translate(-4px, 1px) rotate(1deg); }
    30% { transform: translate(4px, 3px) rotate(0deg); }
    40% { transform: translate(2px, -2px) rotate(1deg); }
    50% { transform: translate(-2px, 3px) rotate(-1deg); }
    60% { transform: translate(-4px, 2px) rotate(0deg); }
    70% { transform: translate(4px, 2px) rotate(-1deg); }
    80% { transform: translate(-2px, -2px) rotate(1deg); }
    90% { transform: translate(2px, 3px) rotate(0deg); }
    100% { transform: translate(0, 0) rotate(0deg); }
  }
  .animate-screen-shake { animation: screen-shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
  
  @keyframes turn-banner-slide {
    0% { transform: translateX(-100%); opacity: 0; }
    20% { transform: translateX(0); opacity: 1; }
    80% { transform: translateX(0); opacity: 1; }
    100% { transform: translateX(100%); opacity: 0; }
  }
  .animate-turn-banner { animation: turn-banner-slide 1.5s ease-in-out forwards; }

  @keyframes scroll-y-overflow {
    0% { transform: translateY(0); }
    20% { transform: translateY(0); } /* Pause at start */
    45% { transform: translateY(var(--scroll-height)); } /* Scroll down */
    55% { transform: translateY(var(--scroll-height)); } /* Pause at end */
    80% { transform: translateY(0); } /* Scroll up */
    100% { transform: translateY(0); } /* Pause at start again */
  }

  @keyframes supply-pulse {
    0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(74, 222, 128, 0.4)); }
    50% { transform: scale(1.05); filter: drop-shadow(0 0 15px rgba(74, 222, 128, 0.8)); }
  }
  .animate-supply-pulse { animation: supply-pulse 2.5s ease-in-out forwards; }

  @keyframes scan-line-sweep {
    0% { top: -10%; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { top: 110%; opacity: 0; }
  }
  .scan-line {
    position: absolute;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.8), transparent);
    box-shadow: 0 0 10px 2px rgba(74, 222, 128, 0.6);
    animation: scan-line-sweep 1.5s ease-in-out forwards;
  }
  
  @keyframes float-particles {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100vh) scale(0.5); opacity: 0; }
  }
  .particle {
    position: absolute;
    background-color: #4ade80; /* green-400 */
    border-radius: 50%;
    animation: float-particles linear infinite;
    pointer-events: none;
  }
  
  @keyframes eva-red-border-pulse {
    0%, 100% { box-shadow: inset 0 0 0 0px rgba(239, 68, 68, 0); }
    50% { box-shadow: inset 0 0 0 8px rgba(239, 68, 68, 0.8); }
  }

  @keyframes eva-glitch-text {
    0%, 100% { text-shadow: 0 0 10px #ef4444, 0 0 20px #ef4444, -2px 2px 2px rgba(0,0,0,0.5); transform: none; }
    25% { text-shadow: 2px 2px 10px #ef4444, -2px -2px 20px #ef4444; transform: skew(-2deg); }
    50% { text-shadow: -2px 2px 10px #ef4444, 2px -2px 20px #ef4444; transform: skew(2deg); }
    75% { text-shadow: 0 0 5px #ef4444, 0 0 10px #ef4444; transform: skew(0); }
  }
  
  .eva-hex-grid {
    background-color: #1a0505;
    background-image:
      linear-gradient(rgba(185, 28, 28, 0.3) 1px, transparent 1px),
      linear-gradient(60deg, rgba(185, 28, 28, 0.3) 1px, transparent 1px),
      linear-gradient(120deg, rgba(185, 28, 28, 0.3) 1px, transparent 1px);
    background-size: 40px 69px;
  }

  .eva-caution-bar {
    position: absolute;
    left: 0;
    right: 0;
    height: 40px;
    background-image: repeating-linear-gradient(
      45deg,
      #ffdd00,
      #ffdd00 25px,
      #1a0505 25px,
      #1a0505 50px
    );
    z-index: 5;
    box-shadow: 0 0 15px rgba(255, 221, 0, 0.4);
    display: flex;
    align-items: center;
    overflow: hidden;
  }
  .eva-caution-bar::before {
    content: 'C A U T I O N // C A U T I O N // C A U T I O N // C A U T I O N // C A U T I O N // C A U T I O N //';
    white-space: nowrap;
    font-family: monospace;
    font-weight: bold;
    font-size: 24px;
    color: rgba(26, 5, 5, 0.8);
    width: 200%;
    text-align: center;
    animation: eva-scroll-text 8s linear infinite;
  }
  @keyframes eva-scroll-text {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }

  /* Status VFX Animations */
  @keyframes burn-flame-anim-optimized {
    0% {
      transform: translate(0, 0) scale(0);
      opacity: 1;
      background-color: #FFDC01; /* yellow */
    }
    20% {
      transform: translate(var(--x-mid), var(--y-mid)) scale(1.2);
      opacity: 1;
    }
    60% {
      background-color: #FDAC01; /* orange */
    }
    100% {
      transform: translate(var(--x-end), var(--y-end)) scale(0);
      opacity: 0;
      background-color: #F73B01; /* red */
    }
  }
  .burn-vfx-container .flame {
    position: absolute;
    top: 50%;
    left: 50%;
    border-radius: 50% 20% / 40% 60%; /* Organic flame shape */
    animation: burn-flame-anim-optimized 1.2s ease-out forwards;
  }
  .burn-vfx-container .flame:nth-child(1) { width: 12px; height: 18px; --x-mid: -20px; --y-mid: -40px; --x-end: -40px; --y-end: -100px; animation-delay: 0s; }
  .burn-vfx-container .flame:nth-child(2) { width: 10px; height: 15px; --x-mid: 25px;  --y-mid: -35px; --x-end: 50px;  --y-end: -90px; animation-delay: 0.1s; }
  .burn-vfx-container .flame:nth-child(3) { width: 14px; height: 20px; --x-mid: 0px;   --y-mid: -50px; --x-end: 0px;   --y-end: -120px; animation-delay: 0.15s; }
  .burn-vfx-container .flame:nth-child(4) { width: 11px; height: 16px; --x-mid: -30px; --y-mid: -20px; --x-end: -60px; --y-end: -60px; animation-delay: 0.2s; }
  .burn-vfx-container .flame:nth-child(5) { width: 13px; height: 19px; --x-mid: 35px;  --y-mid: -15px; --x-end: 70px;  --y-end: -40px; animation-delay: 0.25s; }
  .burn-vfx-container .flame:nth-child(6) { width: 10px; height: 15px; --x-mid: -10px; --y-mid: -45px; --x-end: -20px; --y-end: -110px; animation-delay: 0.3s; }
  .burn-vfx-container .flame:nth-child(7) { width: 12px; height: 18px; --x-mid: 15px;  --y-mid: -55px; --x-end: 30px;  --y-end: -130px; animation-delay: 0.35s; }
  .burn-vfx-container .flame:nth-child(8) { width: 11px; height: 16px; --x-mid: -40px; --y-mid: 0px;   --x-end: -90px; --y-end: 0px; animation-delay: 0.4s; }
  .burn-vfx-container .flame:nth-child(9) { width: 14px; height: 20px; --x-mid: 45px;  --y-mid: 5px;   --x-end: 100px; --y-end: 10px; animation-delay: 0.45s; }
  .burn-vfx-container .flame:nth-child(10){ width: 10px; height: 15px; --x-mid: 5px;   --y-mid: -60px; --x-end: 10px;  --y-end: -140px; animation-delay: 0.5s; }

  @keyframes bleed-particle-anim {
    0% { transform: translate(0, 0) scale(1); opacity: 1; }
    100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; }
  }
  .bleed-vfx-container .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background-color: #b91c1c; /* red-700 */
    border-radius: 50%;
    animation: bleed-particle-anim 0.6s ease-out forwards;
  }
  .bleed-vfx-container .particle:nth-child(1) { --x: 0px; --y: -50px; }
  .bleed-vfx-container .particle:nth-child(2) { --x: 43px; --y: -25px; }
  .bleed-vfx-container .particle:nth-child(3) { --x: 43px; --y: 25px; }
  .bleed-vfx-container .particle:nth-child(4) { --x: 0px; --y: 50px; }
  .bleed-vfx-container .particle:nth-child(5) { --x: -43px; --y: 25px; }
  .bleed-vfx-container .particle:nth-child(6) { --x: -43px; --y: -25px; }
  .bleed-vfx-container .particle:nth-child(7) { --x: 25px; --y: -43px; animation-delay: 0.1s; }
  .bleed-vfx-container .particle:nth-child(8) { --x: 50px; --y: 0px; animation-delay: 0.1s; }
  .bleed-vfx-container .particle:nth-child(9) { --x: 25px; --y: 43px; animation-delay: 0.1s; }
  .bleed-vfx-container .particle:nth-child(10) { --x: -25px; --y: 43px; animation-delay: 0.1s; }
  .bleed-vfx-container .particle:nth-child(11) { --x: -50px; --y: 0px; animation-delay: 0.1s; }
  .bleed-vfx-container .particle:nth-child(12) { --x: -25px; --y: -43px; animation-delay: 0.1s; }

  @keyframes poison-bubble-anim {
    0% { transform: translateY(0) scale(0.5) translateX(0); opacity: 0; }
    20% { opacity: 1; }
    80% { transform: translateY(-70px) scale(1.2) translateX(var(--x-end)); opacity: 1; }
    100% { transform: translateY(-80px) scale(0) translateX(var(--x-end)); opacity: 0; }
  }
  .poison-vfx-container .bubble {
    position: absolute;
    background-color: #65a30d; /* lime-600 */
    border: 1px solid #a3e635; /* lime-400 */
    border-radius: 50%;
    animation: poison-bubble-anim 1s ease-in-out forwards;
  }
  .poison-vfx-container .bubble:nth-child(1) { width: 12px; height: 12px; bottom: 0; left: 50%; --x-end: -5px; animation-delay: 0s; }
  .poison-vfx-container .bubble:nth-child(2) { width: 8px; height: 8px; bottom: 5%; left: 40%; --x-end: 10px; animation-delay: 0.1s; }
  .poison-vfx-container .bubble:nth-child(3) { width: 15px; height: 15px; bottom: 10%; left: 60%; --x-end: -10px; animation-delay: 0.2s; }
  .poison-vfx-container .bubble:nth-child(4) { width: 10px; height: 10px; bottom: 0; left: 30%; --x-end: 5px; animation-delay: 0.3s; }
  .poison-vfx-container .bubble:nth-child(5) { width: 13px; height: 13px; bottom: 5%; left: 70%; --x-end: -5px; animation-delay: 0.4s; }
  .poison-vfx-container .bubble:nth-child(6) { width: 9px; height: 9px; bottom: 15%; left: 45%; --x-end: 8px; animation-delay: 0.5s; }
  .poison-vfx-container .bubble:nth-child(7) { width: 11px; height: 11px; bottom: 2%; left: 55%; --x-end: -8px; animation-delay: 0.6s; }
  .poison-vfx-container .bubble:nth-child(8) { width: 7px; height: 7px; bottom: 8%; left: 35%; --x-end: 12px; animation-delay: 0.7s; }
  .poison-vfx-container .bubble:nth-child(9) { width: 14px; height: 14px; bottom: 12%; left: 65%; --x-end: -12px; animation-delay: 0.8s; }
  .poison-vfx-container .bubble:nth-child(10) { width: 10px; height: 10px; bottom: 3%; left: 48%; --x-end: 0px; animation-delay: 0.9s; }

  /* --- Holographic & Foil Card Effects --- */
  .holographic, .rare-foil {
    isolation: isolate; /* Create stacking context for mix-blend-mode */
    overflow: hidden; /* Fix pseudo-element overflow on rounded corners */
  }

  .holographic {
    --holo1: #efb2fb; /* Epic color 1 */
    --holo2: #acc6f8; /* Epic color 2 */
  }

  .holographic:before,
  .holographic:after {
    content: "";
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;
    border-radius: inherit; /* Inherit border-radius from parent */
    opacity: 0;
    transition: opacity 0.5s ease-out;
    pointer-events: none; /* Make sure pseudo-elements don't block clicks */
  }

  /* Layer 1: Sweeping light band */
  .holographic:before {
    background: linear-gradient(
      115deg,
      transparent 20%,
      var(--holo1) 48%,
      var(--holo2) 52%,
      transparent 80%
    );
    background-size: 250% 250%;
    background-position: 150% 50%;
    mix-blend-mode: color-dodge;
    filter: brightness(0.9) contrast(1.2);
    z-index: 1;
    transition: background-position 0.8s ease-out, opacity 0.5s ease-out;
  }

  /* Layer 2: Sparkle texture */
  .holographic:after {
    background-image: url("https://assets.codepen.io/13471/sparkles.gif"), 
                      url(https://assets.codepen.io/13471/holo.png);
    background-position: center;
    background-size: 180%;
    mix-blend-mode: color-dodge;
    background-blend-mode: overlay;
    filter: brightness(1) contrast(1.1);
    z-index: 2;
  }

  /* --- Rare Foil Effect --- */
  .rare-foil {
    --rare1: #60a5fa; /* blue-400 */
    --rare2: #3b82f6; /* blue-500 */
  }

  .rare-foil:before {
    content: "";
    position: absolute;
    left: 0; top: 0;
    width: 100%; height: 100%;
    border-radius: inherit;
    opacity: 0;
    transition: opacity 0.5s ease-out;
    pointer-events: none;
    background: linear-gradient(
      115deg,
      transparent 20%,
      var(--rare1) 48%,
      var(--rare2) 52%,
      transparent 80%
    );
    background-size: 250% 250%;
    background-position: 150% 50%;
    mix-blend-mode: color-dodge;
    filter: brightness(0.9) contrast(1.2);
    z-index: 1;
    transition: background-position 0.8s ease-out, opacity 0.5s ease-out;
  }

  /* --- Activate on Hover --- */
  .holographic:hover:before {
    opacity: 0.85;
    background-position: -50% 50%;
  }
  
  .holographic:hover:after {
    opacity: 0.9;
  }

  .rare-foil:hover:before {
    opacity: 0.75;
    background-position: -50% 50%;
  }
</style>
</head>
  <body>
    <div id="root"></div>
    <!-- 不允许修改下面这一行 -->
    <script type="module" src="/index.tsx"></script>
  </body>
</html>